<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>COMPUT.</title>

	<link rel="preconnect" href="https://fonts.gstatic.com">
	<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="assets/css/bootstrap.css">
	
	<link rel="stylesheet" href="assets/vendors/iconly/bold.css">
	
	<link rel="stylesheet" href="assets/vendors/perfect-scrollbar/perfect-scrollbar.css">
	<link rel="stylesheet" href="assets/vendors/bootstrap-icons/bootstrap-icons.css">
	<link rel="stylesheet" href="assets/css/app.css">
	<link rel="icon" href="images/favicon.png" type="images/png">
	
	<!-- TOAST UI CDN -->
	<link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
	<link rel="stylesheet" href="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.css" />
	
	<meta id="_csrf" name="_csrf" th:content="${_csrf.token}" />
	<meta id="_csrf_header" name="_csrf_header" th:content="${_csrf.headerName}" />

<style>
.tui-grid-cell {
	/* !important -> ìš°ì„ ìˆœìœ„ ë†’ì•„ì§ */
	background-color: #ffffff !important;
}

.display-flex {
	display: flex;
}

.buttons {
	/* í˜ì´ì§€ëª…ê³¼ ê°™ì€ ìœ„ì¹˜ì—ì„œ ë²„íŠ¼ì„ ì˜¤ë¥¸ìª½ì— ë‘ê¸° ìœ„í•¨ */
	margin-left: auto
}

.buySelect {
	width: 150px !important;
}

.row mb-4{
	display: flex; 
	align-items: center
}

.buyDiv{
	display: flex; 
	align-items: center; 
	max-width: 230px; 
	flex-shrink: 0
}

.nameDiv{
	display: flex; 
	align-items: center; 
	max-width: 400px; 
	flex-shrink: 0;
}



</style>

</head>

<body>

	<div id="app">

		<!-- ì‚¬ì´ë“œ ë©”ë‰´ë°”-->
		<div th:replace="~{fragments/sidebar :: sidebar}"></div>

		<!-- ë©”ì¸ content -->
		<div id="main">


			<div class="display-flex">
				<h3>ì¬ê³ í˜„í™©</h3>
			</div>
			<!-- display-flex -->

			<div class="card">
				<div class="card-body" id="default">
					
					<!-- ê·¸ë¦¬ë“œ ì‹œì‘ -->
					<section class="section">
						<div class="row" id="basic-table">
							<form>
								<!-- ê²€ìƒ‰ ì¡°ê±´ ì‹œì‘ -->
								<div class="row mb-4 align-items-center">
								    <!-- ìƒí’ˆëª… -->
									<div class="col-md-4">
										<label for="nameSearch" class="form-label">í’ˆëª©ëª… ê²€ìƒ‰</label>
										<div class="input-group mb-3">
											<span class="input-group-text" id="basic-addon1"><i class="bi bi-search"></i></span>
											<input type="text" class="form-control" id="searchItem" placeholder="í’ˆëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”." aria-label="Recipient's username"
												aria-describedby="button-addon2">
										</div>
									</div>
									
									
									<!-- ì²« ë²ˆì§¸ SELECT ë°•ìŠ¤: ì°½ê³  ì„ íƒ -->
									<div class="col-md-4">
									  <label for="warehouse">ì°½ê³  ì„ íƒ</label>
									  <select class="form-select deptArea" id="warehouse">
									      <option value="">ì°½ê³ ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
									  </select>
									</div>
									
									  <!-- ë‘ ë²ˆì§¸ SELECT ë°•ìŠ¤: êµ¬ì—­ ì„ íƒ -->
									  <div class="col-md-4">
									  <label for="zone">êµ¬ì—­ ì„ íƒ</label>
									  <select class="form-select deptArea" id="zone">
  										<option value="">êµ¬ì—­ì„ ì„ íƒí•˜ì„¸ìš”</option>
  									  </select>
									  </div>
									
								</div>
								<!-- ê²€ìƒ‰ ì¡°ê±´ ë-->
								
								<!--ì „ì²´/ì™„ì œí’ˆ/ìì¬ íƒ­ ì‹œì‘-->
					          <ul class="nav nav-tabs" id="myTab" role="tablist">
					              <li class="nav-item" role="presentation">
					                  <a class="nav-link active" id="all" data-bs-toggle="tab" href="#home" role="tab"
					                      aria-controls="home" aria-selected="true">ì „ì²´</a>
					              </li>
					              <li class="nav-item" role="presentation">
					                  <a class="nav-link" id="product" data-bs-toggle="tab" href="#profile" role="tab"
					                      aria-controls="profile" aria-selected="false">ì™„ì œí’ˆ</a>
					              </li>
					              <li class="nav-item" role="presentation">
					                  <a class="nav-link" id="material" data-bs-toggle="tab" href="#contact" role="tab"
					                      aria-controls="contact" aria-selected="false">ìì¬</a>
					              </li>
					          </ul>
					          <div class="tab-content" id="myTabContent">
					              <div class="tab-pane fade show active" id="all" role="tabpanel" aria-labelledby="home-tab">
									
									<!--ì¬ê³ í˜„í™© ê·¸ë¦¬ë“œ-->										   
									<div id="inventoryGrid" class="mb-3 mt-2"></div> 
	
					              </div>
					              <div class="tab-pane fade" id="product" role="tabpanel" aria-labelledby="profile-tab">
					                 
					                 <!--ê° íƒ­ë§ˆë‹¤ ê·¸ë¦¬ë“œ id ë‹¤ë¥´ê²Œ í•´ì¤˜ì•¼í•¨-->
									
					              </div>
					              <div class="tab-pane fade" id="material" role="tabpanel" aria-labelledby="contact-tab">
					                  
									<!--ê° íƒ­ë§ˆë‹¤ ê·¸ë¦¬ë“œ id ë‹¤ë¥´ê²Œ í•´ì¤˜ì•¼í•¨-->
									
					              </div>
					          </div>
							  <!--ì „ì²´/ë°›ì€ìš”ì²­/ë³´ë‚¸ìš”ì²­ íƒ­ ë-->
							  
							  <!-- ë²„íŠ¼ ì‹œì‘ -->
  								<!--<div sec:authorize="hasRole('ATHR001') or hasRole('ATHR002')">-->
  									<div class="float-end">
  										<input type="button" class="btn btn-outline-success" id="save"  value="ì €ì¥" onclick="saveAllChanges()">
  									</div>
  								<!--</div>-->
  								<!-- ë²„íŠ¼ ë -->
							</form>
						</div>
					</section>
					<!-- ê·¸ë¦¬ë“œ ë  -->
					
				</div> <!-- card-body -->
			</div> <!-- card -->
			
			<!-- ì¬ê³ í˜„í™© - ì‹¤ì¬ê³ ëŸ‰ ë³€ê²½ ì´ë ¥ ëª¨ë‹¬ì°½ ì‹œì‘ -->
		    <div class="modal fade text-left w-100" id="history" tabindex="-1" role="dialog" aria-labelledby="myModalLabel17" aria-hidden="true">
		        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl"  role="document">
		           
		            <div class="modal-content">
		                <div class="modal-header">
		                    <h4 class="modal-title" id="myModalLabel17"> ì‹¤ì¬ê³ ëŸ‰ ë³€ê²½ ì´ë ¥ </h4>
		                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		                </div>
		                <div class="modal-body">
							<div class="row" id="basic-table">
								<!-- ê·¸ë¦¬ë“œ ì‹œì‘ -->
								<div id="historyGrid"></div>
								<!-- ê·¸ë¦¬ë“œ ë -->
								<div class="d-flex justify-content-end">
									<input type="button" class="btn btn-outline-secondary ms-2" id="append" value="ì¶”ê°€">
									<input type="button" class="btn btn-outline-success ms-2" id="modalSave" value="ì €ì¥">
<!-- 									<div sec:authorize="hasRole('ATHR001') or hasRole('ATHR002')"> -->
										<input type="button" class="btn btn-outline-danger ms-2 deleteBtn" id="delete" value="ì‚­ì œ">
<!-- 									</div> -->
								</div>
							</div>
		                </div>
		            </div>
		        </div>
		    </div> 
		    <!-- ì¬ê³ í˜„í™© - ì‹¤ì¬ê³ ëŸ‰ ë³€ê²½ ì´ë ¥ ëª¨ë‹¬ì°½ ë -->
			
		
	
		</div> <!-- main -->
	</div> <!-- app -->

	<!-- ì œì´ì¿¼ë¦¬ -->
	<script th:src="@{/js/jquery-3.7.1.js}"></script>
	<script th:src="@{/assets/vendors/perfect-scrollbar/perfect-scrollbar.min.js}"></script>
	<script th:src="@{/assets/js/bootstrap.bundle.min.js}"></script>
	<script th:src="@{/assets/js/main.js}"></script>

	<!-- TOAST UI CDN -->
	<script src="https://uicdn.toast.com/tui-grid/latest/tui-grid.js"></script>
	<script src="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.js"></script>
	
	<script th:inline="javascript">

		const header = document.querySelector('meta[name="_csrf_header"]').content;
		const token = document.querySelector('meta[name="_csrf"]').content;

	 	var Grid = tui.Grid;
		
	 	//ì¬ê³ í˜„í™© ê·¸ë¦¬ë“œ
		const inventoryGrid = new Grid({
			el: document.getElementById('inventoryGrid'),
			columns: [
				{header: 'ì¬ê³ ë²ˆí˜¸',	name: 'inventory_no', width: 100},
				{header: 'ì¬ê³ êµ¬ë¶„',	name: 'inventory_type',		editor: 'text', sortable: true, width: 150},
				{header: 'í’ˆëª©ëª…',		name: 'item_name', editor: 'text', sortable: true, width: 200},
				{header: 'ì¬ê³ ëŸ‰',	name: 'inventory_qty',	editor: 'text', sortable: true, width: 100},
				
				{header: 'ì‹¤ì¬ê³ ëŸ‰',	name: 'inventory_count',	editor: 'text', sortable: true, width: 150,
				 defaultValue: 0,
				 formatter: ({ value }) => `<span style="color: #dc3545;">${value}</span>`},
				
				{header: 'ë‹¨ìœ„',	name: 'unit',	editor: 'text', sortable: true, width: 150},
				{header: 'ì°½ê³ ',	name: 'warehouse_id',	editor: 'text', sortable: true, width: 150},
				{header: 'êµ¬ì—­',	name: 'zone',	editor: 'text', sortable: true, width: 150},
				{header: 'ì¬ê³ ëŸ‰ë³€ê²½ì¼',	name: 'inventory_change_date',	editor: 'text', sortable: true, width: 150}
				
			],
			data: [],
			columnOptions: {
			  resizable: true
			}
		});
		
		
		const reasonChangeList = /*[[${reasonChangeList}]]*/ []; // ë³€ê²½ì‚¬ìœ ê³µí†µì½”ë“œ
		console.log('ë³€ê²½ì‚¬ìœ  ê³µí†µì½”ë“œ :', reasonChangeList);
		
		// ì‹¤ì¬ê³ ëŸ‰ ë³€ê²½ ì´ë ¥ ëª¨ë‹¬ ê·¸ë¦¬ë“œ
		const historyGrid = new tui.Grid({
			el: document.getElementById('historyGrid'),
			data: [], // ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ë°ì´í„°
			rowHeaders: ['checkbox'],
			columns: [
				{header: 'ë²ˆí˜¸', name: 'HISTORY_NO', hidden: true, width: 60},
				{header: 'ë³€ê²½ ì „ ì‹¤ì¬ê³ ëŸ‰', name: 'PREV_COUNT', width: 100},
				{header: 'ë³€ê²½ í›„ ì‹¤ì¬ê³ ëŸ‰', name: 'NEW_COUNT', editor: 'text', sortable: true, width: 100},
				{header: 'ì°¨ì´ê°’', name: 'DIFF_COUNT', editor: 'text', sortable: true, width: 100},
				{header: 'ë³€ê²½ì‚¬ìœ ', name: 'CHANGE_REASON', width: 120,
					formatter: ({ value }) => {
				        const reason = reasonChangeList.find(item => item.code === value);
				        return reason ? reason.name : value; // ë§¤ì¹­ë˜ëŠ” nameì´ ìˆìœ¼ë©´ ì¶œë ¥, ì—†ìœ¼ë©´ value ê·¸ëŒ€ë¡œ í‘œì‹œ
				    },
					editor: {
			            type: 'select',
			            options: {
			              listItems: reasonChangeList.map(reason => ({
		                    text: reason.name, // ë³€ê²½ì‚¬ìœ  ì´ë¦„(nameê³¼ codeëŠ” ë§¤í¼ AS "name", AS "code")
		                    value: reason.code // ë³€ê²½ì‚¬ìœ  ì½”ë“œ
			               }))
			            }
					}, 
					},
				{header: 'ê¸°íƒ€ì‚¬ìœ ', name: 'REASON_DETAIL', editor: 'text', sortable: true, width: 200},
				{header: 'ìˆ˜ì •ì', name: 'MOD_USER', width: 100},
				{header: 'ìˆ˜ì •ì¼', name: 'MOD_DATE', width: 150}
				
			]
		});
		
		
		
		let allData = []; // ì „ì²´ ë°ì´í„°ë¥¼ ì €ì¥í•  ë³€ìˆ˜

		
			//ì¬ê³ í˜„í™©í…Œì´ë¸” ì¡°íšŒ
			function loadInventoryData() {
				 
				 let warehouseId = $("#warehouse").val();  //ì„ íƒí•œ ì°½ê³ ê°’
					console.log('ì„ íƒí•œì°½ê³ ê°’', warehouseId);
				 let zone = $("#zone").val(); //ì„ íƒí•œ êµ¬ì—­ê°’
				 let itemName = $("#searchItem").val(); //í’ˆëª©ê²€ìƒ‰
				 	console.log('ê²€ìƒ‰ëª…', itemName)
				
		        $.ajax({
		            url: "/api/inventory/list", 
		            type: "GET",
		            contentType: "application/json",
		            dataType: "json",
					data: {warehouse_id: warehouseId, zone: zone, item_name: itemName },  // í•„í„° ê°’ ì „ë‹¬
		            beforeSend: function(xhr) {
		                xhr.setRequestHeader(header, token);  
		            },
		            success: function(response) {
		            	allData = response; // ì „ì²´ ë°ì´í„° ì €ì¥
		                console.log("ì¬ê³  ë°ì´í„° ë¡œë“œ ì„±ê³µ:", response);
		                inventoryGrid.resetData(response);  // Gridì— ë°ì´í„° ì‚½ì…
		            },
		            error: function(xhr, status, error) {
		                console.error("ì¬ê³  ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", status, error);
		            }
		        });
		    }

		    //í˜ì´ì§€ ë¡œë“œ í›„ ì¦‰ì‹œ ë°ì´í„° ë¡œë“œ
		    loadInventoryData();
			
			
			 const tabs = {
				        ì „ì²´: document.getElementById('all'),
				        ì™„ì œí’ˆ: document.getElementById('product'),
				        ìì¬: document.getElementById('material')
				    };
			
			 			
			// íƒ­ í´ë¦­ ì´ë²¤íŠ¸ ë“±ë¡
	        Object.keys(tabs).forEach(tabName => {
	            tabs[tabName].addEventListener('click', () => {
	                let filteredData;
	                if (tabName === 'ì „ì²´') {
	                    filteredData = allData; // ì „ì²´ ë°ì´í„°
	                } else {
	                    filteredData = allData.filter(item => item.inventory_type === tabName); // ìš”ì²­êµ¬ë¶„ì— ë”°ë¥¸ í•„í„°ë§
	                }

	                inventoryGrid.resetData(filteredData); // í•„í„°ë§ëœ ë°ì´í„°ë¥¼ TOAST UI Gridì— ì ìš©
	                inventoryGrid.refreshLayout(); // ë ˆì´ì•„ì›ƒ ìƒˆë¡œê³ ì¹¨
	            });
	        });	
				
	
			
	
	//--------------------------------------------------------ì‹¤ì¬ê³ ëŸ‰ ë³€ê²½ì´ë ¥ ëª¨ë‹¬ì°½ ì‹œì‘
		
	
		let emp_id = /*[[${emp_id}]]*/'UNKNOWN'; //ë¡œê·¸ì¸í•œ ì‚¬ë²ˆ
		let inventory_no = null; // í´ë¦­í•œ í–‰ì˜ ì¬ê³ ë²ˆí˜¸
		let inventory_count = null; // í´ë¦­í•œ í–‰ì˜ ì‹¤ì¬ê³ ëŸ‰
		
		//ëª¨ë‹¬ì°½ ì—´ë¦´ë•Œ
		inventoryGrid.on('click', function (ev) {
			 
			    //ëª¨ë‹¬ì°½ ì´ˆê¸°í™”
			    historyGrid.resetData([]);
			    
			    // í´ë¦­ëœ row ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
	        	const rowData = ev.instance.getRow(ev.rowKey);
	        	inventory_no = rowData.inventory_no;
	        	inventory_count = rowData.inventory_count;
	        	
				console.log('ë¡œê·¸ì¸í•œ ì‚¬ë²ˆ : ', emp_id);	        
				console.log('í´ë¦­í•œ í–‰ì˜ ì¬ê³ ë²ˆí˜¸ : ', inventory_no);	        
				console.log('í´ë¦­í•œ í–‰ì˜ ì‹¤ì¬ê³ ëŸ‰ : ', inventory_count);	        
				
				$('#history').modal('show');
				

			//ë³€ê²½ì´ë ¥ ë°ì´í„° ì¡°íšŒ ìš”ì²­ (GET /api/inventory/history/{inventory_no})
			$('#history').on('shown.bs.modal', function () {
			fetch(`/api/inventory/history/${inventory_no}`)
			        .then(response => response.json())
			        .then(data => {
			            console.log("ë¶ˆëŸ¬ì˜¨ ë³€ê²½ì´ë ¥ ë°ì´í„°:", data);
			            
			            // âœ… ë³€ê²½ í›„ ì‹¤ì¬ê³ ëŸ‰ - ë³€ê²½ ì „ ì‹¤ì¬ê³ ëŸ‰ ê³„ì‚° í›„ ì—…ë°ì´íŠ¸
		                const updatedData = data.map(row => ({
		                    ...row,
		                    DIFF_COUNT: row.NEW_COUNT - row.PREV_COUNT
		                }));

			            //ë³€ê²½ì´ë ¥ ë°ì´í„°ë¥¼ TOAST UI Gridì— ì ìš©
			            historyGrid.resetData(updatedData);
			            historyGrid.refreshLayout();
						
			        })
			        .catch(error => {
			            console.error("Error fetching history data:", error);
			        });
	        	});
			});
		
		
		//ì°¨ì´ê°’ ìë™ì…ë ¥
		historyGrid.on('afterChange', (ev) => {
		    ev.changes.forEach(change => {
		        if (change.columnName === 'NEW_COUNT') {
		            const rowKey = change.rowKey;
		            const newCount = historyGrid.getValue(rowKey, 'NEW_COUNT') || 0;
		            const prevCount = historyGrid.getValue(rowKey, 'PREV_COUNT') || 0;
		
		            historyGrid.setValue(rowKey, 'DIFF_COUNT', newCount - prevCount);
		        }
		    });
		});

			
		// "ì¶”ê°€" ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
		$('#append').on('click', function (e) {
			e.preventDefault(); // ê¸°ë³¸ ë™ì‘ ë°©ì§€
			
			if (!inventory_no || inventory_no === null) {
			       alert("ì¬ê³ ë²ˆí˜¸ë¥¼ ì„ íƒí•´ì•¼í•¨");
			       return;
			   }

			   console.log('ì¶”ê°€ ë²„íŠ¼ í´ë¦­: inventory_no =', inventory_no, ', inventory_count =', inventory_count);
			
		    // ê¸°ë³¸ê°’ìœ¼ë¡œ ìƒˆ í–‰ ë°ì´í„° ìƒì„±
			const newRow = {
				HISTORY_NO: '',
				PREV_COUNT: inventory_count,
				NEW_COUNT: '',
				CHANGO_REASON: '', 
				REASON_DETAIL: '', 
				MOD_USER: emp_id, 
				MOD_DATE: '' ,
				DIFF_COUNT: ''
			};
		
			// ìƒˆ í–‰ì„ TOAST UI Gridì— ì¶”ê°€
			historyGrid.prependRow(newRow, {
				focus: true // ì¶”ê°€ëœ í–‰ì— í¬ì»¤ìŠ¤
			});
			historyGrid.refreshLayout();
			
		}); // ì¶”ê°€ ë²„íŠ¼ ì´ë²¤íŠ¸
	
		
		// "ì €ì¥" ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
			$('#modalSave').on('click', async function () {
				
				const checkedColumns = ['PREV_COUNT', 'NEW_COUNT', 'CHANGE_REASON', 'MOD_USER']
				// ëª¨ë“  í–‰ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
				  let rows = historyGrid.getData();
				
				// ê¸°ì¡´ í–‰(`HISTORY_NO`ê°€ ìˆëŠ” ê²½ìš°) ì œì™¸í•˜ê³  ìƒˆë¡œìš´ í–‰ë§Œ í•„í„°ë§
			    rows = rows.filter(row => !row.HISTORY_NO && row.NEW_COUNT !== "");
				
				
				  // ë¹ˆ ê°’ì´ ìˆëŠ”ì§€ í™•ì¸
				  for (const row of rows) {
				      for (const column of checkedColumns) {
				          if (row[column] === null || row[column] === undefined || row[column] === '') {
				              alert(`"${column}" ê°’ì´ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤. ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.`);
				              return; // ì €ì¥ ì¤‘ë‹¨
				          }
				      }
				  }
				  	
				  	let date  = [];
				  	data = rows.map(row =>({
					inventory_no: inventory_no, //ì „ì—­ë³€ìˆ˜ í´ë¦­í•œ í–‰ì˜ ì¬ê³ ë²ˆí˜¸
					prev_count: row.PREV_COUNT,
					new_count: row.NEW_COUNT,
					change_reason: row.CHANGE_REASON || null,
					reason_detail: row.REASON_DETAIL,
					mod_user: emp_id, //ì „ì—­ë³€ìˆ˜
					diff_count: row.DIFF_COUNT
					
				  }));
				  
				  console.log("@ì „ì†¡ ë°ì´í„°:", JSON.stringify(data));
				  
				  // ëª¨ë“  ê°’ì´ ì…ë ¥ëœ ê²½ìš°, ì €ì¥ ë¡œì§ ì‹¤í–‰
			     try {
					const response = await fetch('/api/inventory/history/save', {
			           method: 'POST',
			           headers: { 'Content-Type': 'application/json',
				   	    [header]: token },
			           body: JSON.stringify(data)
			       });
				   
				   if (response.ok) {
				              alert('ì €ì¥ ì™„ë£Œ!');
				              $('#history').modal('hide');
				              location.reload(true); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
				          } else {
				              alert('ì €ì¥ ì‹¤íŒ¨');
				          }
			     } catch (error) {
			         console.error('ì €ì¥ ì‹¤íŒ¨:', error);
			         alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
			     }
				
			}); // ì €ì¥ í´ë¦­ ì´ë²¤íŠ¸
			
		
			
			
			
		//"ì‚­ì œ" ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
		$('#delete').on('click', async function () {
		    const selectedRows = historyGrid.getCheckedRows();
		    
		    if (selectedRows.length === 0) {
		        alert("ì‚­ì œí•  ë³€ê²½ ì´ë ¥ì„ ì„ íƒí•˜ì„¸ìš”.");
		        return;
		    }

		    const historyNoList = selectedRows.map(row => row.HISTORY_NO); // ì„ íƒëœ PK ë¦¬ìŠ¤íŠ¸
		    console.log("ì‚­ì œí•  ë³€ê²½ ì´ë ¥ ëª©ë¡:", historyNoList);

		    try {
		        const response = await fetch('/api/inventory/history/delete', {
		            method: 'POST',
		            headers: { 
		                'Content-Type': 'application/json',
		                [header]: token
		            },
		            body: JSON.stringify({
		                historyNoList: historyNoList,
		                inventoryNo: inventory_no  // ì „ì—­ ë³€ìˆ˜ ì‚¬ìš©
		            })
		        });

		        if (response.ok) {
		            alert('ì‚­ì œ ì™„ë£Œ ë° ì¬ê³  í˜„í™© ì—…ë°ì´íŠ¸ ì™„ë£Œ');
		            $('#history').modal('hide'); // ëª¨ë‹¬ ë‹«ê¸°
		            location.reload(); // ìƒˆë¡œê³ ì¹¨í•˜ì—¬ UI ë°˜ì˜
		        } else {
		            alert('ì‚­ì œ ì‹¤íŒ¨');
		        }
		    } catch (error) {
		        console.error('ì‚­ì œ ì˜¤ë¥˜:', error);
		        alert('ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ');
		    }
		});

			
		
		//selectë°•ìŠ¤ ì°½ê³ ì¡°íšŒ, êµ¬ì—­ì¡°íšŒ
		$(document).ready(function(){
			
		   // ì°½ê³  ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
           $.get("/api/inventory", function (data) {
               data.forEach(wh => {
                   $('#warehouse').append(`<option value="${wh.warehouse_id}">${wh.warehouse_name}</option>`);
               });
           });
		
		   // ì°½ê³  ì„ íƒ ì‹œ êµ¬ì—­ ë¶ˆëŸ¬ì˜¤ê¸°
           $('#warehouse').change(function () {
               let warehouseId = $(this).val();
               $('#zone').html('<option value="">êµ¬ì—­ ì„ íƒ</option>');

               if (warehouseId) {
                   $.get(`/api/inventory/${warehouseId}/zone`, function (data) {
                       data.forEach(zone => {
                           $('#zone').append(`<option value="${zone}">${zone}</option>`);
                       });
                   });
               }
		   		
			   loadInventoryData();  // ì°½ê³  ì„ íƒ ì‹œ ë°ì´í„° ì¡°íšŒ
           });
		   
		   // êµ¬ì—­ ì„ íƒ ì‹œ í•„í„°ë§ëœ ì¬ê³  ë°ì´í„° ì¡°íšŒ
		      $('#zone').change(function() {
		          loadInventoryData();  // êµ¬ì—­ ì„ íƒ ì‹œ ë°ì´í„° ì¡°íšŒ
		      });
			  
		  //í’ˆëª©ëª… ê²€ìƒ‰ ë°ì´í„° ì¡°íšŒ
			  $("#searchItem").on("keyup", function() {
			         loadInventoryData(); // ğŸ”¥ ê²€ìƒ‰ ì…ë ¥í•  ë•Œë§ˆë‹¤ ë°ì´í„° ë¡œë“œ
			     });  	
				 
		      // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
		      loadInventoryData();  
		   
		});// document.ready ë
		
		
		
		
		
		
		
		
		
		
		
		
		
		
			
		
		
	</script>

</body>

</html>