<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>급여 지급 이력</title>

    <!-- CSS 링크 -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/bootstrap.css">
    <link rel="stylesheet" href="assets/vendors/iconly/bold.css">
    <link rel="stylesheet" href="assets/vendors/perfect-scrollbar/perfect-scrollbar.css">
    <link rel="stylesheet" href="assets/vendors/bootstrap-icons/bootstrap-icons.css">
    <link rel="stylesheet" href="assets/css/app.css">
    <link rel="shortcut icon" href="assets/images/favicon.svg" type="assets/image/x-icon">
    <!-- TOAST UI Grid CSS -->
    <link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
    
   <style>
    /* 그리드 스타일 */
    .tui-grid-cell {
        background-color: #ffffff !important;
    }
	</style>
</head>

<body>
    <div id="app">
        <!-- 사이드 메뉴바-->
        <div th:replace="~{fragments/sidebar :: sidebar}"></div>
        
        <!-- 메인 content -->
        <div id="main">
            <!-- 반응형 사이드 메뉴 버튼-->
            <header class="mb-3">
                <a href="#" class="burger-btn d-block d-xl-none">
                    <i class="bi bi-justify fs-3"></i>
                </a>
            </header>
            
            <h3>급여 지급 현황</h3>
            
            <!-- 메인 그리드 카드 -->
            <div class="card">
                <div class="card-body">
                    <!-- 검색 필터 -->
                    <div style="margin-bottom: 10px; display: flex; align-items: center;">
                        <select class="form-select" id="basicSelect" style="width: 150px;">
                            <option>전체</option>
                            <option>인사팀</option>
                            <option>마케팅팀</option>
                            <option>영업팀</option>
                            <option>개발팀</option>
                            <option>재무팀</option>
                            <option>CS팀</option>
                        </select>
                        <input type="text" class="form-control" id="basicInput" 
                               style="margin-left: 5px; width:200px;" 
                               placeholder="사원이름 검색">
                        <a href="#" class="btn btn-primary rounded-pill" 
                           style="margin-left: 5px;">Search</a>
                    </div>
                    <!-- 메인 그리드 -->
                    <div id="grid" style="width:100%; height:100%;"></div>
                    <a href="#" class="btn btn-secondary" 
                       style="margin-top: 5px;">선택삭제</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 급여 이체 현황 모달 -->
	<div class="modal fade" id="large" tabindex="-1" role="dialog" 
	     aria-labelledby="myModalLabel17" aria-hidden="true">
	    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg"
	         role="document">
	        <div class="modal-content">
	            <div class="modal-header">
	                <h4 class="modal-title" id="myModalLabel17">급여 이체 현황</h4>
	                <button type="button" class="btn-close" data-bs-dismiss="modal"
	                        aria-label="Close"></button>
	            </div>
	            <div class="modal-body">
	                <div id="modalGrid"></div>
	            </div>
	            <div class="modal-footer">
	                <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
	                    닫기
	                </button>
	            </div>
	        </div>
	    </div>
	</div>

    <!-- 스크립트 -->
    <script src="assets/vendors/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/main.js"></script>
    <script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>

    <script>
        // 데이터값
        const gridData = [
            { 
                date: "2024/12", emp_num: "001", emp_name: "변종석", 
                allow_cd_1: "3,800,000", allow_cd_2: "200,000", allow_cd_3: "100,000", 
                allow_amt: "4,100,000", deduc_cd_1: "200,000", deduc_cd_2: "50,000", 
                deduc_cd_3: "150,000", deduc_cd_4: "150,000", deduc_cd_5: "50,000", 
                deduc_cd_6: "50,000", deduc_amt: "650,000", all: "3,450,000" 
            },
            // ... 나머지 데이터
        ];

        // 메인 그리드 초기화
        const grid = new tui.Grid({
            el: document.getElementById('grid'),
            data: gridData,
            rowHeaders: ['checkbox'],
            scrollX: false,
            scrollY: false,
            columns: [
                { header: '귀속연월', name: 'date' },
                { header: '사원번호', name: 'emp_num' },
                { header: '사원이름', name: 'emp_name', className: 'grid-cell-hover' },
                { header: '기본급', name: 'allow_cd_1' },
                { header: '연차수당', name: 'allow_cd_2' },
                { header: '성과급', name: 'allow_cd_3' },
                { header: '총수당액', name: 'allow_amt' },
                { header: '소득세', name: 'deduc_cd_1' },
                { header: '주민세', name: 'deduc_cd_2' },
                { header: '국민연금', name: 'deduc_cd_3' },
                { header: '건강보험', name: 'deduc_cd_4' },
                { header: '고용보험', name: 'deduc_cd_5' },
                { header: '산재보험', name: 'deduc_cd_6' },
                { header: '총공제액', name: 'deduc_amt' },
                { header: '실지급액', name: 'all' }
            ]
        });

		// 전역 변수로 modalGrid 선언
        let modalGrid = null;

        // 사원이름 클릭 이벤트 처리
        grid.on('click', (ev) => {
            if (ev.columnName === 'emp_name') {
                const rowData = grid.getRow(ev.rowKey);
                
                // 모달 표시
                const modal = new bootstrap.Modal(document.getElementById('large'));
                modal.show();
                
                // 모달이 완전히 표시된 후 그리드 초기화
                document.getElementById('large').addEventListener('shown.bs.modal', function () {
                    if (modalGrid) {
                        modalGrid.destroy();
                    }
                    
                    // 6개월치 데이터 생성 (예시)
                    const modalData = [];
                    for(let i = 0; i < 12; i++) {
                        const date = new Date(rowData.date.replace('/', '-') + '-01');
                        date.setMonth(date.getMonth() - i);
                        const monthStr = `${date.getFullYear()}/${String(date.getMonth() + 1).padStart(2, '0')}`;
                        
                        modalData.push({
                            bank: '국민은행',
                            name: rowData.emp_name,
                            salary: rowData.all,
                            date: `${monthStr}/25`
                        });
                    }
                    
                    // 모달 그리드 초기화
                    modalGrid = new tui.Grid({
                        el: document.getElementById('modalGrid'),
                        data: modalData,
                        scrollX: false,
                        scrollY: false,
                        columns: [
                            { header: '은행명', name: 'bank' },
                            { header: '사원이름', name: 'name' },
                            { header: '지급액', name: 'salary' },
                            { header: '지급일', name: 'date' }
                        ],
                        header: {
                            height: 40,
//                             align: 'center'
                        },
                        rowHeaders: ['rowNum'],
                        bodyHeight: 300
                    });
                }, { once: true }); // 이벤트 리스너는 한 번만 실행
            }
        });

        // 모달이 닫힐 때 그리드 정리
        document.getElementById('large').addEventListener('hidden.bs.modal', function () {
            if (modalGrid) {
                modalGrid.destroy();
                modalGrid = null;
            }
        });

    </script>
</body>
</html>