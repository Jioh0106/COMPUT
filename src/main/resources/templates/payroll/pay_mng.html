<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>급여 관리</title>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/bootstrap.css">
    <link rel="stylesheet" href="assets/vendors/iconly/bold.css">
    <link rel="stylesheet" href="assets/vendors/perfect-scrollbar/perfect-scrollbar.css">
    <link rel="stylesheet" href="assets/vendors/bootstrap-icons/bootstrap-icons.css">
    <link rel="stylesheet" href="assets/css/app.css">
    <link rel="shortcut icon" href="assets/images/favicon.svg" type="assets/image/x-icon">
    <!-- TOAST UI CDN -->
    <link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
    
    <style>
        /* Toast UI Grid 스타일 */
        .tui-grid {
            border: 1px solid #ccc;
            border-collapse: collapse;
        }
        .tui-grid-cell {
            border-right: 1px solid #ccc !important;
            border-bottom: 1px solid #ccc !important;
        }
        .tui-grid-header-area {
            border-bottom: 2px solid #ccc !important;
        }

        

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }

        .tab {
            overflow: hidden;
            border: 1px solid #ccc;
            background-color: #f1f1f1;
            margin-bottom: 20px;
        }

        .tab button {
            background-color: inherit;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 14px 16px;
            transition: 0.3s;
        }

        .tab button:hover {
            background-color: #ddd;
        }

        .tab button.active {
            background-color: #435ebe;
            color: white;
        }

        .tabcontent {
            display: none;
            padding: 6px 12px;
        }

        .btn-wrapper {
            margin-top: 10px;
            text-align: right;
        }

        .btn-submit {
            background-color: #435ebe;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }

        .grid-wrapper {
            margin-top: 20px;
            height: 300px;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- 사이드 메뉴바-->
        <div th:replace="~{fragments/sidebar :: sidebar}"></div>
        
        <!-- 메인 content -->
        <div id="main">
            <!-- 반응형 사이드 메뉴 버튼-->
            <header class="mb-3">
                <a href="#" class="burger-btn d-block d-xl-none">
                    <i class="bi bi-justify fs-3"></i>
                </a>
            </header>
            
            <h3>급여 관리</h3>
            
            <!-- 급여관리 -->
            <hr>
            <div style="margin-bottom: 10px; display: flex; align-items: center;">
                <a href="#" class="btn btn-primary">급여 항목 입력</a>
            </div>
            
            <!-- 메인 그리드 시작 -->
            <div id="grid" style="width:100%; height:100%;"></div>
            <!-- 메인 그리드 끝 -->
            
            <hr>
            
            <div id="grid1" style="width:100%; height:100%;"></div>
            <a href="#" class="btn btn-secondary" style="margin-top: 5px;">선택삭제</a>
        </div>
    </div>

    <!-- 모달 창 -->
	<div class="modal fade" id="salaryModal" tabindex="-1" role="dialog" aria-labelledby="salaryModalLabel" aria-hidden="true">
	        <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
	            <div class="modal-content">
	                <div class="modal-header">
	                    <h4 class="modal-title" id="salaryModalLabel">급여 항목 입력</h4>
	                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
	                        <i class="bi bi-x"></i>
	                    </button>
	                </div>
	                
	                <div class="modal-body">
	                    <!-- 탭 네비게이션 -->
	                    <ul class="nav nav-tabs" id="salaryTab" role="tablist">
	                        <li class="nav-item" role="presentation">
	                            <button class="nav-link active" id="allowance-tab" data-bs-toggle="tab" data-bs-target="#allowance" 
	                                    type="button" role="tab" aria-controls="allowance" aria-selected="true">수당</button>
	                        </li>
	                        <li class="nav-item" role="presentation">
	                            <button class="nav-link" id="deduction-tab" data-bs-toggle="tab" data-bs-target="#deduction" 
	                                    type="button" role="tab" aria-controls="deduction" aria-selected="false">공제</button>
	                        </li>
	                    </ul>
	                    
	                    <!-- 탭 컨텐츠 -->
	                    <div class="tab-content" id="salaryTabContent">
	                        <!-- 수당 탭 -->
	                        <div class="tab-pane fade show active" id="allowance" role="tabpanel" aria-labelledby="allowance-tab">
	                            <div id="allowanceGrid" class="grid-wrapper"></div>
	                            <div class="d-flex justify-content-end mt-3">
	                                <button onclick="addAllowanceRow()" class="btn btn-secondary me-2">항목 추가</button>
	                                <button onclick="saveAllowance()" class="btn btn-primary">저장</button>
	                            </div>
	                        </div>
	                        
	                        <!-- 공제 탭 -->
	                        <div class="tab-pane fade" id="deduction" role="tabpanel" aria-labelledby="deduction-tab">
	                            <div id="deductionGrid" class="grid-wrapper"></div>
	                            <div class="d-flex justify-content-end mt-3">
	                                <button onclick="addDeductionRow()" class="btn btn-secondary me-2">항목 추가</button>
	                                <button onclick="saveDeduction()" class="btn btn-primary">저장</button>
	                            </div>
	                        </div>
	                    </div>
	                </div>
	                
	                <div class="modal-footer">
	                    <button type="button" class="btn btn-light-secondary" data-bs-dismiss="modal">
	                        <span class="d-none d-sm-block">닫기</span>
	                    </button>
	                </div>
	            </div>
	        </div>
	    </div>

    <!-- Scripts -->
    <script src="assets/vendors/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/main.js"></script>
    <!-- TOAST UI CDN -->
    <script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>

    <script>
        // 메인 그리드 데이터
        const gridData = [
            { emp_num: "공제", emp_name: "소득세", allow_cd_1: "급여액에 따른 세율", allow_cd_2: "원", allow_cd_3: ""},
            { emp_num: "공제", emp_name: "지방세", allow_cd_1: "소득세 x 0.1", allow_cd_2: "원", allow_cd_3: ""},
            { emp_num: "공제", emp_name: "국민보험", allow_cd_1: "과세급여 x 0.45", allow_cd_2: "원", allow_cd_3: ""},
            { emp_num: "공제", emp_name: "건강보험", allow_cd_1: "과세급여 x 0.3545", allow_cd_2: "원", allow_cd_3: "2024년 기준"},
            { emp_num: "공제", emp_name: "고용보험", allow_cd_1: "과세급여 x 0.09", allow_cd_2: "원", allow_cd_3: ""},
        ];

        // 메인 그리드 생성
        const grid = new tui.Grid({
            el: document.getElementById('grid'),
            data: gridData,
            rowHeaders: ['checkbox'],
            scrollX: false,
            scrollY: false,
            columns: [
                { header: '구분', name: 'emp_num' },
                { header: '항목명', name: 'emp_name', className: 'grid-cell-hover' },
                { header: '계산식', name: 'allow_cd_1' },
                { header: '단위', name: 'allow_cd_2' },
                { header: '설명', name: 'allow_cd_3' }
            ]
        });

        // 수당 그리드 데이터
        const allowanceData = [
            { id: 1, category: '기본급', amount: 3800000 },
            { id: 2, category: '연차수당', amount: 200000 },
            { id: 3, category: '성과급', amount: 100000 }
        ];

        // 공제 그리드 데이터
        const deductionData = [
            { id: 1, category: '소득세', amount: 200000 },
            { id: 2, category: '주민세', amount: 50000 },
            { id: 3, category: '국민연금', amount: 150000 },
            { id: 4, category: '건강보험', amount: 150000 },
            { id: 5, category: '고용보험', amount: 50000 },
            { id: 6, category: '산재보험', amount: 50000 }
        ];

        // 수당 그리드
        const allowanceGrid = new tui.Grid({
            el: document.getElementById('allowanceGrid'),
            data: allowanceData,
			scrollX: false,
	        scrollY: true,
	        bodyHeight: 250,
            columns: [
                {
                    header: '항목',
                    name: 'category',
                    editor: 'text'
                },
                {
                    header: '금액',
                    name: 'amount',
                    editor: 'text',
                    formatter: (value) => {
                        return value.value.toLocaleString() + '원';
                    }
                }
            ]
        });

        // 공제 그리드
        const deductionGrid = new tui.Grid({
            el: document.getElementById('deductionGrid'),
            data: deductionData,
			scrollX: false,
	        scrollY: true,
	        bodyHeight: 250,
            columns: [
                {
                    header: '항목',
                    name: 'category',
                    editor: 'text'
                },
                {
                    header: '금액',
                    name: 'amount',
                    editor: 'text',
                    formatter: (value) => {
                        return value.value.toLocaleString() + '원';
                    }
                }
            ]
        });
		
		// 모달 객체 생성
		        const salaryModal = new bootstrap.Modal(document.getElementById('salaryModal'));
		        
		        // 모달 열기 이벤트
		        document.querySelector('.btn.btn-primary').addEventListener('click', function() {
		            salaryModal.show();
		            setTimeout(() => {
		                allowanceGrid.refreshLayout();
		                deductionGrid.refreshLayout();
		            }, 100);
		        });

		        // 탭 전환 시 그리드 리프레시
		        document.querySelectorAll('button[data-bs-toggle="tab"]').forEach(button => {
		            button.addEventListener('shown.bs.tab', function (event) {
		                if (event.target.id === 'allowance-tab') {
		                    allowanceGrid.refreshLayout();
		                } else {
		                    deductionGrid.refreshLayout();
		                }
		            });
		        });

        // 모달 관련 이벤트
        document.querySelector('.btn.btn-primary').addEventListener('click', function() {
            document.getElementById('salaryModal').style.display = "block";
            allowanceGrid.refreshLayout();
            deductionGrid.refreshLayout();
        });

        document.querySelector('.close').addEventListener('click', function() {
            document.getElementById('salaryModal').style.display = "none";
        });

        window.addEventListener('click', function(event) {
            if (event.target == document.getElementById('salaryModal')) {
                document.getElementById('salaryModal').style.display = "none";
            }
        });

        // 탭 전환 함수
        function openTab(evt, tabName) {
            var i, tabcontent, tablinks;
            
            tabcontent = document.getElementsByClassName("tabcontent");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            
            tablinks = document.getElementsByClassName("tablinks");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            
            document.getElementById(tabName).style.display = "block";
            evt.currentTarget.className += " active";
            
            if (tabName === 'allowance') {
                allowanceGrid.refreshLayout();
            } else {
                deductionGrid.refreshLayout();
            }
        }

        // 수당 행 추가
        function addAllowanceRow() {
            allowanceGrid.appendRow({
                id: allowanceGrid.getData().length + 1,
                category: '',
                amount: 0
            });
        }

        // 공제 행 추가
        function addDeductionRow() {
            deductionGrid.appendRow({
                id: deductionGrid.getData().length + 1,
                category: '',
                amount: 0
            });
        }

        // 수당 저장
        function saveAllowance() {
            const data = allowanceGrid.getData();
            console.log('수당 데이터 저장:', data);
            // 여기에 저장 로직 추가
        }

        // 공제 저장
        function saveDeduction() {
		            const data = deductionGrid.getData();
		            console.log('공제 데이터 저장:', data);
		            // 여기에 저장 로직 추가
		        }

		        // 메인 그리드 이벤트
		        grid.on('check', ev => {
		            console.log('check!', ev);
		        });

		        grid.on('uncheck', ev => {
		            console.log('uncheck!', ev);
		        });

		        grid.on('focusChange', ev => {
		            console.log('change focused cell!', ev);
		        });
		    </script>
		</body>
		</html>