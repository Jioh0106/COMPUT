<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<body>
<div th:fragment="main">
	<!-- main.html -->
	<div id="main">

		<header class="mb-3">
			<a href="#" class="burger-btn d-block d-xl-none">
				<i class="bi bi-justify fs-3"></i>
			</a>
		</header>

		<div class="page-heading">
			<button type="button" class="btn btn-primary btn-lg" id="atndBtn"
				onclick="cmtBtn()">ì¶œê·¼í•˜ê¸°</button>
		</div>
		<div class="card">
			<div class="card-body">
				<h4>ê·¼ë¬´ ì¼ì •</h4>
				<div id="calendar" style="height: 600px;"></div>
			</div>
		</div>	
     
	</div>
	<!-- main.html ë-->


<script src="https://uicdn.toast.com/calendar/latest/toastui-calendar.min.js"></script>
<!-- ì œì´ì¿¼ë¦¬ -->
<script src="/js/jquery-3.7.1.js"></script>
<script src="/assets/vendors/perfect-scrollbar/perfect-scrollbar.min.js"></script>
<script src="/assets/js/bootstrap.bundle.min.js"></script>

<script th:inline="javascript" th:src="@{/js/main_work.js}"></script>

<!-- sweetAlert CDN -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
	


<script th:inline="javascript">

	const header = document.querySelector('meta[name="_csrf_header"]').content;
	const token = document.querySelector('meta[name="_csrf"]').content;
	
	let atndBtn;

	// í™”ë©´ ë¡œë“œ ì‹œ ê³µí†µì½”ë“œ ì¡°íšŒ
	window.onload = function () {
		
		// ì¶œ/í‡´ê·¼ í™•ì¸ ì¡°íšŒ í•¨ìˆ˜
		selectCmt();
		
		if(atndBtn == "end"){
			const btn = document.getElementById("atndBtn");
			btn.textContent = "í‡´ê·¼í•˜ê¸°"; // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
		} else {
			const btn = document.getElementById("atndBtn");
			btn.textContent = "ì¶œê·¼í•˜ê¸°"; // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
		}

		  var Calendar = window.tui.Calendar;

	      var cal = new Calendar('#main-calendar', {
	        defaultView: 'month',
	        calendars: MOCK_CALENDARS,
	        template: {
	          monthGridHeader: function (data) {
	            var date = parseInt(data.date.split('-')[2], 10);

	            return (
	              '<span class="calendar-month-header" style="margin-left: 4px;">' +
	              (data.month + 1) +
	              '/' +
	              date +
	              '</span>'
	            );
	          },
	          monthGridHeaderExceed: function (hiddenEvents) {
	            return (
	              '<span class="calendar-month-header-exceed" style="font-size: 0.8rem">' +
	              '+' +
	              hiddenEvents +
	              '</span>'
	            );
	          },
	          monthDayName: function (data) {
	            var label = data.label;

	            if (data.day === 5) {
	              label = 'ğŸ‰ TGIF';
	            }

	            return '<span class="calendar-month-day-name">' + label + '</span>';
	          },
	        },
	      });
	    
	};
	
	function selectCmt() {
		fetch(
			"/mainCmt",

			{
				method: "POST"
				, headers: {
					'header': header,
					"Content-Type": "application/json",
					'X-CSRF-Token': token
				}
				, body: JSON.stringify({
					btnType: "cmtBtn"
				})

			})
			.then(resp => resp.json()) // ì‘ë‹µ ê°ì²´ë¥¼ ë§¤ê°œë³€ìˆ˜ë¡œ ì–»ì–´ì™€ íŒŒì‹±
			.then(data => {
				console.info(data);
			})
	};

	// ì¶œ/í‡´ê·¼ ë²„íŠ¼ ì²˜ë¦¬
	function cmtBtn() {
		console.info(header);
		fetch(
			"/insertCmt",
			{
				method: "POST"
				, headers: {
					'header': header,
					"Content-Type": "application/json",
					'X-CSRF-Token': token
				}
				/*, body: JSON.stringify({
					btnType: id
				})*/

			})
			.then(response => {
				console.info(response);
				Swal.fire({
					title: "ì‹ ì²­ ì™„ë£Œ",
					icon: "success",
					confirmButtonText: "í™•ì¸"
				}).then(function () { // í™•ì¸ í´ë¦­ ì‹œ ì‹¤í–‰
					atndBtn = "end";
					window.location.href = '/cmt-stts'; // ì¶œí‡´ê·¼ í˜„í™© í˜ì´ì§€ë¡œ ì´ë™
				});
				
            })
	};

</script>
</div>
</body>

</html>