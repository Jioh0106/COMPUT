<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOT 추적</title>

    <!-- CSS 라이브러리 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.15/themes/default/style.min.css">
    
    <link rel="stylesheet" th:href="@{/assets/css/bootstrap.css}">
    <link rel="stylesheet" th:href="@{/assets/vendors/perfect-scrollbar/perfect-scrollbar.css}">
    <link rel="stylesheet" th:href="@{/assets/css/app.css}">
    
    <meta id="_csrf" name="_csrf" th:content="${_csrf.token}" />
    <meta id="_csrf_header" name="_csrf_header" th:content="${_csrf.headerName}" />
    
    <style>
        /* 기본 스타일 */
        body { 
            background-color: #f8f9fa; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }
        
		 /* 헤더 영역 */
        .page-header {
            padding: 20px 30px;
            background: white;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .page-title {
            font-size: 24px;
            color: #1a1a1a;
            margin: 0;
        }

        .breadcrumb {
            margin: 0;
            font-size: 14px;
        }

        /* 카드 컴포넌트 스타일 */
        .dashboard-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            margin-bottom: 1.5rem;
        }

        .dashboard-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .card-header {
            border-bottom: 1px solid #edf2f7;
            padding: 1.25rem;
            background: none;
        }

        .card-header h6 {
            margin: 0;
            font-weight: 600;
            color: #2d3748;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* 검색 영역 스타일 */
        .search-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .search-input-wrapper {
            position: relative;
            flex: 1;
        }

        .search-input {
            padding-left: 40px;
            height: 40px;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            width: 100%;
            font-size: 14px;
        }
        
        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
        }
        
        .search-select {
            height: 40px;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            padding: 0 12px;
            font-size: 14px;
            color: #374151;
            background-color: white;
            min-width: 180px;
        }

        .search-button {
            height: 40px;
            padding: 0 24px;
            background-color: #4F46E5;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 500;
        }
        
        /* 탭 네비게이션 */
        .tab-list {
            display: flex;
            gap: 4px;
            padding: 0 20px;
            margin-bottom: 20px;
        }

        .tab-item {
            display: flex;
            align-items: center;
            padding: 10px 20px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            color: #6b7280;
            font-size: 14px;
            cursor: pointer;
            gap: 8px;
        }

        .tab-item.active {
            background: #4F46E5;
            color: white;
            border-color: #4F46E5;
        }

        .tab-item i {
            font-size: 16px;
        }

        /* LOT 목록 */
        .lot-list {
            padding: 0 20px;
        }

        .lot-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            margin-bottom: 4px;
            cursor: pointer;
        }

        .lot-item:hover {
            background: #f9fafb;
        }

        .lot-item.selected {
            background: #f0f9ff;
            border-color: #4F46E5;
        }

        .lot-icon {
            color: #6b7280;
            margin-right: 12px;
            font-size: 18px;
        }

        .lot-info {
            flex: 1;
        }

        .lot-number {
            font-size: 14px;
            color: #374151;
            font-weight: 500;
        }

        .lot-description {
            font-size: 13px;
            color: #6b7280;
            margin-top: 2px;
        }

        .lot-status {
            padding: 4px 8px;
            background: #f3f4f6;
            border-radius: 4px;
            font-size: 12px;
            color: #374151;
        }

        .lot-status.unfinished {
            background: #fee2e2;
            color: #991b1b;
        }

        /* LOT 카드 스타일 */
        .lot-card {
            border-radius: 10px;
            border-left: 4px solid;
            padding: 1.25rem;
            margin-bottom: 1rem;
            background: white;
            transition: all 0.2s ease;
        }

        .lot-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* 공정 타입별 스타일 */
        .process-assembly {
            border-left-color: #3182ce;
            background: linear-gradient(135deg, #ebf8ff 0%, #ffffff 100%);
        }

        .process-machining {
            border-left-color: #38a169;
            background: linear-gradient(135deg, #f0fff4 0%, #ffffff 100%);
        }

        .process-heat {
            border-left-color: #dd6b20;
            background: linear-gradient(135deg, #fffaf0 0%, #ffffff 100%);
        }

        .process-qc {
            border-left-color: #805ad5;
            background: linear-gradient(135deg, #faf5ff 0%, #ffffff 100%);
        }

        /* 상태 뱃지 스타일 */
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.025em;
        }

        .status-created { background: #e2e8f0; color: #2d3748; }
        .status-progress { background: #bee3f8; color: #2c5282; }
        .status-complete { background: #c6f6d5; color: #276749; }
        .status-hold { background: #feebc8; color: #9c4221; }

        /* 계층 구조 스타일 */
        .lot-hierarchy-view {
            min-height: 300px;
            padding: 1.5rem;
            background: white;
            border-radius: 10px;
        }

        .hierarchy-level {
            margin: 1.5rem 0;
            position: relative;
        }

        .hierarchy-level::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 20px;
            height: 2px;
            background: #cbd5e0;
        }

        .children-wrapper {
            margin-left: 2rem;
            padding-left: 2rem;
            border-left: 2px solid #cbd5e0;
        }

        /* 탭 네비게이션 스타일 */
        .nav-tabs {
            border: none;
            margin-bottom: 1rem;
            gap: 0.5rem;
        }

        .nav-tabs .nav-link {
            border: none;
            padding: 0.75rem 1.25rem;
            border-radius: 8px;
            color: #4a5568;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .nav-tabs .nav-link:hover {
            background: #edf2f7;
            color: #2d3748;
        }

        .nav-tabs .nav-link.active {
            background: #3182ce;
            color: white;
        }

        /* 그리드 스타일 커스터마이징 */
        .tui-grid-container {
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #e2e8f0;
        }

        .tui-grid-cell {
            font-size: 0.875rem;
            color: #4a5568;
        }

        .tui-grid-header-cell {
            background: #f7fafc;
            font-weight: 600;
            color: #2d3748;
        }

        /* 반응형 스타일 */
        @media (max-width: 768px) {
            .search-section {
                flex-direction: column;
                gap: 12px;
            }

            .search-select {
                width: 100%;
            }

            .search-button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div th:replace="~{fragments/sidebar :: sidebar}"></div>
        <div id="main">
            <div class="page-heading d-flex justify-content-between align-items-center mb-4">
                <h3>COMPUT.</h3>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-0">
                        <li class="breadcrumb-item"><a href="/"><i class="bi bi-house"></i></a></li>
                        <li class="breadcrumb-item">생산관리</li>
                        <li class="breadcrumb-item active" aria-current="page">LOT 추적</li>
                    </ol>
                </nav>
            </div>
            
            <div class="page-content">
                <div class="container-fluid">
                    <!-- 검색 영역 -->
                    <div class="search-section d-flex gap-3">
				        <div class="search-input-wrapper">
				            <i class="bi bi-search search-icon"></i>
				            <input type="text" class="search-input" placeholder="LOT 번호 또는 제품명으로 검색">
				        </div>
				        <select class="search-select">
				            <option value="">전체 제품</option>
				        </select>
				        <select class="search-select">
				            <option value="">전체 공정</option>
				        </select>
				        <button class="search-button">
				            <i class="bi bi-search me-2"></i>검색
				        </button>
				    </div>

                    <div class="row">
                        <!-- LOT 트리 영역 -->
                        <div class="col-md-3">
                            <div class="dashboard-card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">
                                        <i class="bi bi-diagram-3 me-2"></i>LOT 목록
                                    </h6>
                                    <button class="btn btn-sm btn-light" id="expandAllBtn">
                                        <i class="bi bi-arrows-angle-expand"></i>
                                    </button>
                                </div>
                                <div class="card-body p-0">
                                    <div id="lotTreeView" class="lot-tree-container"></div>
                                </div>
                            </div>
                        </div>

                        <!-- 상세 정보 영역 -->
                        <div class="col-md-9">
                            <!-- 탭 네비게이션 -->
                            <ul class="nav nav-tabs" role="tablist">
                                <li class="nav-item">
                                    <a class="nav-link active" data-bs-toggle="tab" href="#hierarchyTab">
                                        <i class="bi bi-diagram-3 me-2"></i>계층 구조
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#processTab">
                                        <i class="bi bi-gear me-2"></i>공정 이력
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" data-bs-toggle="tab" href="#qcTab">
                                        <i class="bi bi-clipboard-check me-2"></i>품질 이력
                                    </a>
                                </li>
                            </ul>

                            <!-- 탭 컨텐츠 -->
                            <div class="tab-content">
                                <!-- 계층 구조 탭 -->
                                <div class="tab-pane fade show active" id="hierarchyTab">
                                    <div class="dashboard-card">
                                        <div class="card-header d-flex justify-content-between align-items-center">
                                            <h6 class="mb-0">LOT 계층 구조</h6>
                                            <div class="btn-group">
                                                <button id="directionToggleBtn" class="btn btn-sm btn-outline-primary">
                                                    <i class="bi bi-arrow-down-up me-2"></i>정방향
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body">
                                            <div id="lotHierarchyView" class="lot-hierarchy-view"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 공정 이력 탭 -->
                                <div class="tab-pane fade" id="processTab">
                                    <div class="dashboard-card">
                                        <div class="card-header">
                                            <h6 class="mb-0">공정 이력</h6>
                                        </div>
                                        <div class="card-body">
                                            <div id="processHistoryGrid"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- 품질 이력 탭 -->
                                <div class="tab-pane fade" id="qcTab">
                                    <div class="dashboard-card">
                                        <div class="card-header">
                                            <h6 class="mb-0">품질검사 이력</h6>
                                        </div>
                                        <div class="card-body">
                                            <div id="qcHistoryGrid"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript 라이브러리 -->
    <script th:src="@{/js/jquery-3.7.1.js}"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.1/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.3.15/jstree.min.js"></script>
    <script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    
    <script th:src="@{/assets/js/bootstrap.bundle.min.js}"></script>
    <script th:src="@{/assets/vendors/perfect-scrollbar/perfect-scrollbar.min.js}"></script>
    <script th:src="@{/assets/js/main.js}"></script>

    <!-- 애플리케이션 스크립트 -->
    <script th:src="@{/js/lot/lot_tracking.js}"></script>
</body>
</html>