<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>인사발령등록</title>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/bootstrap.css">

    <link rel="stylesheet" href="assets/vendors/iconly/bold.css">

    <link rel="stylesheet" href="assets/vendors/perfect-scrollbar/perfect-scrollbar.css">
    <link rel="stylesheet" href="assets/vendors/bootstrap-icons/bootstrap-icons.css">
    <link rel="stylesheet" href="assets/css/app.css">
    <link rel="shortcut icon" href="assets/images/favicon.svg" type="assets/image/x-icon">
	<!-- TOAST UI CDN -->
	<link rel="stylesheet" href="https://uicdn.toast.com/grid/latest/tui-grid.css" />
	
	<style>
		.tui-grid-cell {
			/* !important -> 우선순위 높아짐 */
			background-color: #ffffff !important;
		}
	</style>
	
</head>
<body>
		
	<div id="app">
		
		<!-- 사이드 메뉴바-->
		<div th:replace="~{fragments/sidebar :: sidebar}"></div>
		
		<!-- 메인 content -->
		<div id="main">
			
			<!-- 반응형 사이드 메뉴 버튼-->
			<header class="mb-3">
				<a href="#" class="burger-btn d-block d-xl-none">
					<i class="bi bi-justify fs-3"></i>
				</a>
			</header>
			
			<h3>인사발령등록</h3>

			
 <!--인사발령등록 폼 시작-->			
<!-- // Basic multiple Column Form section start -->
<section id="multiple-column-form">
	<div class="row match-height">
		<div class="col-12">
			<div class="card">
				<div class="card-header">
<!--					<h4 class="card-title">인사발령등록 작성</h4>-->
					
				</div>
				<div class="card-content">
					<div class="card-body">
					<form class="form">
						
						<div class="row">
							
							<div class="col-md-6 col-12">
								<div class="form-group">
									<label for="first-name-column">담당자 사번</label>
									<input type="text" name="emp_id" id="emp_id" class="form-control" 
									readonly>
								</div>
							</div>
							
							<div class="col-md-6 col-12">
								<div class="form-group">
									<label for="first-name-column">담당자 성명</label>
									<input type="text" id="emp_name" name="emp_name" class="form-control" 
									readonly>
								</div>
							</div>
							
							
							<div class="col-md-6 col-12">
								<div class="form-group">
									<label for="first-name-column">발령자 사번</label>
									<input type="text" id="assign_emp_id" class="form-control"
										 name="assign_emp_id">
								</div>
							</div>
							
							<div class="col-md-6 col-12">
								<div class="form-group">
									<label for="last-name-column">발령자 성명</label>
									<input type="text" id="assign_emp_name" class="form-control"
										 name="assign_emp_name">
								</div>
							</div>
							
							
							<div class="col-md-6 col-12">
								<div class="form-group">
									<label>발령일자</label>
									<div class="form-group">
										<input type="date" class="form-control" id="assign_date" onchange="calcDate()"
										name="assign_date">
									</div>
								</div>
							</div>
							
							
							<div class="col-md-6 col-12">
								<div class="form-group">
									<label for="city-column">발령구분</label>
										<select id="assign_type" class="form-control" name="assign_type">
											<option>구분 선택</option>
										</select>
								</div>
							</div>
							
							<div class="col-md-6 col-12">
								<div class="form-group">
									<label for="company-column">이전직급</label>
									<input type="text" id="prev_pos" class="form-control"
										name="prev_pos">
								</div>
							</div>
							<div class="col-md-6 col-12">
								<div class="form-group">
									<label for="email-id-column">발령직급</label>
										<select id="new_pos" class="form-control" name="new_pos">
											<option>직급 선택</option>
										</select>
								</div>
							</div>
							<div class="col-md-6 col-12">
								<div class="form-group">
									<label for="company-column">이전부서</label>
									<input type="text" id="prev_dept" class="form-control"
										name="prev_dept">
								</div>
							</div>
							<div class="col-md-6 col-12">
								<div class="form-group">
									<label for="email-id-column">발령부서</label>
										<select id="new_dept" class="form-control" name="new_dept">
											<option>부서 선택</option>
										</select>
								</div>
							</div>
							<div class="col-12 d-flex justify-content-end">
								<button type="button" class="btn btn-primary me-1 mb-1" data-bs-target="#defaultSize"
								 data-bs-toggle="modal">등록</button>
								<button type="reset" class="btn btn-outline-danger me-1 mb-1">취소</button>
							</div>
						</div>
					</form>
					</div>
				</div>
			</div>
		</div>
	</div>
</section>
	<!-- // Basic multiple Column Form section end -->
	<!--인사발령등록 폼 끝-->
			
			
			<!--직원 검색 모달창 시작-->
			<!--large size Modal -->
       <div class="modal fade text-left" id="large" tabindex="-1" role="dialog"
           aria-labelledby="myModalLabel17" aria-hidden="true">
           <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg"
               role="document">
               <div class="modal-content">
				  <div class="modal-header"> 
                       <h4 class="modal-title" id="myModalLabel17">직원검색</h4>
                       <button type="button" class="close" data-bs-dismiss="modal"
                           aria-label="Close">
                           <i data-feather="x"></i>
                       </button>
                   </div>
				   
                   <div class="modal-body">
					
					<div class="col-md-6 mb-1"><!--직원이름검색창-->
						<div class="input-group mb-3">
							<span class="input-group-text" id="basic-addon1"><i class="bi bi-search"></i></span>
							<input type="text" class="form-control" id="nameSearch" placeholder="이름을 입력해주세요." aria-label="Recipient's username"
								aria-describedby="button-addon2">
						</div>
					</div>
					
					<!-- 그리드 시작 -->
					<section class="section">
						<div class="row" id="basic-table">
							<div id="grid1"></div>
						</div>
					</section>
					<!-- 그리드 끝 -->
					 
                   </div>
                   <div class="modal-footer">
                       <button type="button" class="btn btn-light-secondary"
                           data-bs-dismiss="modal">
                           <i class="bx bx-x d-block d-sm-none"></i>
                           <span class="d-none d-sm-block">취소</span>
                       </button>
                       <button type="button" class="btn btn-primary ml-1" id="largeBtn"
                           data-bs-dismiss="modal">
                           <i class="bx bx-check d-block d-sm-none"></i>
                           <span class="d-none d-sm-block">선택</span>
                       </button>
                   </div>
               </div>
           </div>
       </div>
			<!--직원 검색 모달창 끝-->
			
			
			
			<!--승인권자 선택 모달창 시작-->
			<!--Default size Modal -->
        <div class="modal fade text-left" id="defaultSize" tabindex="-1"
            role="dialog" aria-labelledby="myModalLabel18" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable"
                role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title" id="myModalLabel18">승인권자 선택</h4>
                        <button type="button" class="close" data-bs-dismiss="modal"
                            aria-label="Close">
                            <i data-feather="x"></i>
                        </button>
                    </div>
                    <div class="modal-body">
						
						<!-- 그리드 시작 -->
						<section class="section">
							<div class="row" id="basic-table">
								<div id="grid2"></div>
							</div>
						</section>
						<!-- 그리드 끝 -->
						
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-light-secondary"
                            data-bs-dismiss="modal">
                            <i class="bx bx-x d-block d-sm-none"></i>
                            <span class="d-none d-sm-block">취소</span>
                        </button>
                        <button type="button" class="btn btn-primary ml-1"
                            data-bs-dismiss="modal">
                            <i class="bx bx-check d-block d-sm-none"></i>
                            <span class="d-none d-sm-block">승인요청</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
			<!--승인권자 선택 모달창 끝-->
			
			
			
		</div><!--main--> 

	</div><!-- app -->
		
		
	<script src="assets/vendors/perfect-scrollbar/perfect-scrollbar.min.js"></script>
	<script src="assets/js/bootstrap.bundle.min.js"></script>
	<script src="assets/js/main.js"></script>
	<!-- TOAST UI CDN -->
	<script src="https://uicdn.toast.com/grid/latest/tui-grid.js"></script>
	<script src="js/assign_insert.js"></script>
	<script>
	
		// 발령자사번 클릭 시 직원검색 모달창
		   document.getElementById('assign_emp_id').addEventListener('click', function () {
		       // 모달 창을 보여줌
		       var myModal = new bootstrap.Modal(document.getElementById('large'), {
		           backdrop: 'static'  // 모달 바깥 클릭해도 닫히지 않게 설정 (필요 시)
		       });
		       myModal.show();
		   });
		
		//토스트 ui 모달창 그리드 시작
		document.addEventListener('DOMContentLoaded', function () {
		      var Grid = tui.Grid;

		      // 직원검색 모달창 Grid 생성
		      const grid1 = new Grid({
		          el: document.getElementById('grid1'),
		          columns: [
		              { header: '사원번호', name: 'emp_id' },
		              { header: '성명', name: 'emp_name' },
		              { header: '부서명', name: 'emp_dept' },
		              { header: '직급', name: 'emp_position' }
		          ],
		          data: [] //초기데이터는 비워져있음
		      });
			  
			  document.getElementById('nameSearch').addEventListener('input', function () {
			        const keyword = this.value.trim(); // 입력된 키워드
					
					console.log("입력된 키워드:", keyword); // 디버그용 로그 출력
					console.log("요청 URL:", `/api/empSearch?keyword=${encodeURIComponent(keyword)}`);
					
			        if (keyword.length > 0) {
			            fetch(`/api/empSearch?keyword=${encodeURIComponent(keyword)}`)
			                .then(response => {
			                    if (!response.ok) {
			                        throw new Error('검색 요청 중 오류가 발생했습니다.');
			                    }
			                    return response.json();
			                })
			                .then(data => {
			                    grid1.resetData(data); // 검색 결과로 그리드 데이터 설정
								grid1.refreshLayout(); // 레이아웃 새로고침
			                })
			                .catch(error => {
			                    console.error('검색 중 오류가 발생했습니다.', error);
			                    alert('검색 중 오류가 발생했습니다.');
			                });
			        } else {
			            grid1.resetData([]); // 키워드가 없을 경우 그리드를 비움
			        }
			    });

		      // 첫번째 모달이 열릴 때 Grid 리렌더링
		      const largeModal = document.getElementById('large');
		     largeModal.addEventListener('shown.bs.modal', function () {
		          grid1.refreshLayout();
		      });

			  

			  //직원검색에서 특정 그리드 선택
			  let selectedRow = null;

			  		grid1.on('click', (ev) => {
			  		selectedRow = grid1.getRow(ev.rowKey); // 선택된 행의 데이터 가져오기
			  		console.log(JSON.stringify(selectedRow));
			  	});	  
			  		
			  	document.querySelector('#largeBtn').addEventListener('click',() => {
			  		
			  		if(selectedRow){
			  			document.getElementById('assign_emp_id').value = selectedRow.emp_id;
			  			document.getElementById('assign_emp_name').value = selectedRow.emp_name;
			  			document.getElementById('prev_pos').value = selectedRow.emp_position;
			  			document.getElementById('prev_dept').value = selectedRow.emp_dept;
			  			
			  			// 모달창 닫기
			  			$('#large').modal('hide'); // Bootstrap Modal 닫기
						
			  		}else{
			  			alert("직원을 선택해 주세요.");
			  		}
			  		
			  	});
			  
			  
			  
		     
			  //-------------------------------------------------------------승인권자 선택 모달창 시작
			  
			 

			  	      // 승인권자 선택 모달창 Grid 생성
			  	      const grid2 = new Grid({
			  	          el: document.getElementById('grid2'),
			  	          columns: [
			  	              { header: '사원번호', name: 'emp_id' },
			  	              { header: '성명', name: 'emp_name' },
			  	              { header: '부서명', name: 'emp_dept' },
			  	              { header: '직급', name: 'emp_position' }
			  	          ],
			  	          data: []
			  	      });

			  	      // 두번째 모달이 열릴 때 Grid 리렌더링
			  	      const defaultModal = document.getElementById('defaultSize');
			  	      defaultModal.addEventListener('shown.bs.modal', function () {
			  	          
						//ajax로 데이터 가져오기
						fetch('/api/middleRole')
						.then(response => response.json()) //json형태로 파싱
						.then(data => {
							grid2.resetData(data) // grid2에 새로운 데이터 바인딩
							grid2.refreshLayout();
						})
						
						.catch(error => {
						     console.error('Error fetching middle role data:', error);
						   })
						
			  	      });
		
		 
			 });//토스트 ui 모달창 그리드 끝
		  
		  
									
		  
		  
	</script>
	
</body>

</html>
